"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7022],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},y=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),y=c(n),d=i,m=y["".concat(l,".").concat(d)]||y[d]||p[d]||a;return n?r.createElement(m,o(o({ref:t},u),{},{components:n})):r.createElement(m,o({ref:t},u))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=y;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<a;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}y.displayName="MDXCreateElement"},7446:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var r=n(7462),i=(n(7294),n(3905));const a={sidebar_position:2},o="Referencing everything",s={unversionedId:"Tutorial/Extending_persyst/Referencing_everything",id:"Tutorial/Extending_persyst/Referencing_everything",title:"Referencing everything",description:"This is not really an easy thing to do. At this point, you are kind of implementing new features for Persyst, so the code you need to write is no longer just a copule of attributes and a property here and there.",source:"@site/docs/Tutorial/Extending_persyst/Referencing_everything.md",sourceDirName:"Tutorial/Extending_persyst",slug:"/Tutorial/Extending_persyst/Referencing_everything",permalink:"/persyst-docs/Tutorial/Extending_persyst/Referencing_everything",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Using reflection",permalink:"/persyst-docs/Tutorial/Extending_persyst/using_reflection"}},l={},c=[],u={toc:c};function p(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"referencing-everything"},"Referencing everything"),(0,i.kt)("p",null,"This is not really an easy thing to do. At this point, you are kind of implementing new features for Persyst, so the code you need to write is no longer just a copule of attributes and a property here and there. "),(0,i.kt)("p",null,"I would still recommend not getting into this at all, and trying to organize your data in a way that only requires the features of base Persyst. I'm honestly not sure this is the best way to handle reference serialization anyways. That being said, I will give a working example, so that you can at least get an idea of how to make things work for your project."),(0,i.kt)("p",null,"The general idea is one that should be familiar by now: serializing UIDs. We will have this class: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cs"},"public class Item_tracker : MonoBehaviour, ISaveable\n{\n    public static Dictionary<ulong, Item> items = new Dictionary<ulong, Item>();\n    public static Item_tracker instance;\n\n    [SaveThis] Dictionary<ulong, Item> _items{\n        get{return items;}\n        set{items = value;}\n    }\n\n    void OnEnable(){\n        if(instance!=null && instance != this)\n            Destroy(instance);\n\n        instance = this;\n    }\n\n    public ulong registerItem(Item item){\n        System.Random random = new System.Random();\n        byte[] buf = new byte[8]; \n        ulong value;\n        do{\n            random.NextBytes(buf);\n            value = (ulong)System.BitConverter.ToInt64(buf, 0);\n        }while(items.ContainsKey(value));\n        \n        items.Add(value, item);\n        return value;\n    }\n\n}\n")),(0,i.kt)("p",null,"to manage that. You can see that we are serializing a dictionary that maps UIDs to instances of our ",(0,i.kt)("inlineCode",{parentName:"p"},"Item")," class. When we deserialize it, we will be creating all the instances and storing them in memory. Now, for the other part of the puzzle:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cs"},"public class Item {\n    public ulong uid {get;} //the uid is set in the constructor and cannot be modified\n\n    //you can put any other data in here and make this class ISaveable, if you want it to actually do something\n\n    public Item(){\n        uid = Item_tracker.instance.registerItem(this);\n    }\n}\n\npublic class ItemWrapper : ISaveable{\n    [SaveThis] ulong uid{\n        get{return item!=null? item.uid : 0;}\n        set{item = Item_tracker.items[value];} //the object instance is recovered automatically when you read the UID from the savefile!\n    }\n\n    public Item item;\n}\n")),(0,i.kt)("p",null,"The whole game here is that we are not going to serialize references to ",(0,i.kt)("inlineCode",{parentName:"p"},"Item")," directly, but instead we are going to serialize ",(0,i.kt)("inlineCode",{parentName:"p"},"ItemWrapper"),". Thus, the only thing we are going to serialize is the UID of the referenced ",(0,i.kt)("inlineCode",{parentName:"p"},"Item"),". When that is deserialized, the setter of the property will query ",(0,i.kt)("inlineCode",{parentName:"p"},"Item_tracker")," and retrieve a reference to the actual object."),(0,i.kt)("p",null,"Now, this works, but there are several problems with it. "),(0,i.kt)("p",null,"For starters, you have to ",(0,i.kt)("a",{parentName:"p",href:"/persyst-docs/Tutorial/Getting%20started/saving_and_loading"},"manually manage the loading order"),", to make sure the ",(0,i.kt)("inlineCode",{parentName:"p"},"Item_tracker")," is loaded before any references are to be retrieved. Otherwise, you will be tryig to reference objects that have not been created yet. You can always try to implement your own version of the ",(0,i.kt)("a",{parentName:"p",href:"/persyst-docs/Tutorial/Know_more/Pending_references"},"pending references system"),", but I would not recommend going that way."),(0,i.kt)("p",null,"Also, none of this plays nicely with Unity's serialization, so you kind of need to choose which one it's going to be: serializing references with Persyst, or using Unity's ",(0,i.kt)("inlineCode",{parentName:"p"}," [SerializeField]"),'. "Both" is a headache waiting to happen. This does not apply to regular by-value Persyst serialization.'))}p.isMDXComponent=!0}}]);