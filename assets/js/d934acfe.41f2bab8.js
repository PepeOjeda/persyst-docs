"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[920],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=p(n),u=i,m=d["".concat(l,".").concat(u)]||d[u]||h[u]||r;return n?a.createElement(m,s(s({ref:t},c),{},{components:n})):a.createElement(m,s({ref:t},c))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,s=new Array(r);s[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:i,s[1]=o;for(var p=2;p<r;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5683:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var a=n(7462),i=(n(7294),n(3905));const r={sidebar_position:3},s="Inheritance",o={unversionedId:"Know_more/inheritance",id:"Know_more/inheritance",title:"Inheritance",description:"Does inheritance work? Yes.",source:"@site/docs/Know_more/inheritance.md",sourceDirName:"Know_more",slug:"/Know_more/inheritance",permalink:"/persyst-docs/Know_more/inheritance",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Nesting classes",permalink:"/persyst-docs/Know_more/Nesting_classes"},next:{title:"The Pending References System",permalink:"/persyst-docs/Know_more/Pending_references"}},l={},p=[{value:"Private fields of the parent class",id:"private-fields-of-the-parent-class",level:2},{value:"Type of the reference vs type of the object",id:"type-of-the-reference-vs-type-of-the-object",level:2},{value:"Deserializing with a type mismatch",id:"deserializing-with-a-type-mismatch",level:2}],c={toc:p};function h(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"inheritance"},"Inheritance"),(0,i.kt)("p",null,"Does inheritance work? Yes."),(0,i.kt)("p",null,"Are there any limitations you need to keep in mind? Also yes."),(0,i.kt)("h2",{id:"private-fields-of-the-parent-class"},"Private fields of the parent class"),(0,i.kt)("p",null,"Persyst will only inspect the class it's given for members tagged as ",(0,i.kt)("inlineCode",{parentName:"p"},"[SaveThis]"),". It will not examine the base class. "),(0,i.kt)("p",null,"That means ",(0,i.kt)("inlineCode",{parentName:"p"},"private")," members of the parent class will not be serialized, only those that are ",(0,i.kt)("inlineCode",{parentName:"p"},"protected")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"public"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cs"},"public class MyMB : MonoBehaviour, ISaveable\n{\n    [SaveThis] ChildClass child;\n}\n\npublic class ParentClass : ISaveable\n{\n    [SaveThis] int aPrivateInt; //no\n    [SaveThis] public int aPublicInt; //yes\n    [SaveThis] protected int aProtectedInt; //yes\n}\n\npublic class ChildClass : ParentClass\n{\n    [SaveThis] int myInt; //yes\n}\n")),(0,i.kt)("h2",{id:"type-of-the-reference-vs-type-of-the-object"},"Type of the reference vs type of the object"),(0,i.kt)("p",null,"With inheritance, you can have something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cs"},"public class MyMB : MonoBehaviour, ISaveable\n{\n    [SaveThis] ParentClass child = new ChildClass();\n}\n")),(0,i.kt)("p",null,"In this case, Persyst would serialize ",(0,i.kt)("inlineCode",{parentName:"p"},"child")," as a ",(0,i.kt)("inlineCode",{parentName:"p"},"ChildClass")," object, not a ",(0,i.kt)("inlineCode",{parentName:"p"},"ParentClass")," one. This means all the values that are specific to the ",(0,i.kt)("inlineCode",{parentName:"p"},"ChildClass")," get serialized correctly, which is good, but all the private fields of the parent are ignored, which is bad."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"This is not how the built-in Unity serializer works. There, the objects get serialized as the type of the class member, not the underlying type of the instance. Keep in mind this discrepancy when serializing this kind of thing with both systems at the same time.")),(0,i.kt)("h2",{id:"deserializing-with-a-type-mismatch"},"Deserializing with a type mismatch"),(0,i.kt)("p",null,"This won't ",(0,i.kt)("em",{parentName:"p"},"break")," the serialization, but you probably want to avoid doing it, for it will be confusing and probably end up causing bugs."),(0,i.kt)("p",null,"If you have this class:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cs"},"public class MyMB : MonoBehaviour, ISaveable\n{\n    [SaveThis] ParentClass field = new ParentClass();\n}\n")),(0,i.kt)("p",null,"and read a file where ",(0,i.kt)("inlineCode",{parentName:"p"},"field")," was serialized as a ",(0,i.kt)("inlineCode",{parentName:"p"},"ParentClass"),", then the current instance that ",(0,i.kt)("inlineCode",{parentName:"p"},"field")," refers to is maintained, and only the relevant members are updated. Meaning that, for this definition of ",(0,i.kt)("inlineCode",{parentName:"p"},"ParentClass"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cs"},"public class ParentClass : ISaveable\n{\n    [SaveThis] int myInt;\n    [SaveThis] protected int protectedInt;\n    int anotherInt;\n    protected int anotherProtectedInt;\n}\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"myInt")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"protectedInt")," get updated by the Persyst-serialized value, while ",(0,i.kt)("inlineCode",{parentName:"p"},"anotherInt")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"anotherProtectedInt")," retain the value that they already have."),(0,i.kt)("p",null,"..."),(0,i.kt)("p",null,"However, if ",(0,i.kt)("inlineCode",{parentName:"p"},"field")," was serialized as a ",(0,i.kt)("inlineCode",{parentName:"p"},"ChildClass"),", and its current value is an instance of ",(0,i.kt)("inlineCode",{parentName:"p"},"ParentClass"),", then the current instance is ",(0,i.kt)("strong",{parentName:"p"},"discarded")," and the system creates a new object of ",(0,i.kt)("inlineCode",{parentName:"p"},"ChildClass")," that gets populated with the serialized values. But, since the only one of these values that is both serialized by Persyst and visible by ",(0,i.kt)("inlineCode",{parentName:"p"},"ChildClass")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"protectedInt"),", that is ",(0,i.kt)("strong",{parentName:"p"},"the only one")," that will be recovered."),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"This means the value of all other members of the existing ",(0,i.kt)("inlineCode",{parentName:"p"},"ParentClass")," instance will be lost. Not overwritten by a meaningful serialized value, but instead reset to the default value of that datatype. You probably never want this to happen."),(0,i.kt)("p",{parentName:"admonition"},"While this is not undefined behaviour (what I've just explained is exactly what will happen), this can ",(0,i.kt)("em",{parentName:"p"},"very easily")," cause bugs if you are using both the Unity serialization and Persyst to serialize polymorphic objects. You might expect the Unity-serialized values of the parent to remain unchanged, as Persyst will not explicitly overwrite them, but ",(0,i.kt)("strong",{parentName:"p"},"that's not what will happen. Those values will be lost.")),(0,i.kt)("p",{parentName:"admonition"},"I would recommend never doing this at all. "),(0,i.kt)("p",{parentName:"admonition"},"Unless you ",(0,i.kt)("strong",{parentName:"p"},"really")," know what you're doing, I guess. After all, I'm not your dad.")))}h.isMDXComponent=!0}}]);